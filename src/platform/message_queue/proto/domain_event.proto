syntax = "proto3";

package ticketing.events;

// Subsection configuration (embedded in BookingCreatedDomainEvent)
// Using optional to distinguish between "not set" and "set to 0" (e.g., free tickets)
message SubsectionConfig {
  optional int32 rows = 1;
  optional int32 cols = 2;
  optional int32 price = 3;
}

// 1. Ticketing → Reservation: New booking created
message BookingCreatedDomainEvent {
  string booking_id = 1;
  int32 buyer_id = 2;
  int32 event_id = 3;
  int32 total_price = 4;
  string section = 5;
  int32 subsection = 6;
  int32 quantity = 7;
  string seat_selection_mode = 8;
  repeated string seat_positions = 9;
  string status = 10;
  int64 occurred_at = 11;  // Unix timestamp ms
  SubsectionConfig config = 12;  // Optional config for downstream
  // OpenTelemetry W3C Trace Context
  string traceparent = 13;
  string tracestate = 14;
}

// 2. Ticketing → Reservation: Booking paid
message BookingPaidEvent {
  string booking_id = 1;
  int32 buyer_id = 2;
  int32 event_id = 3;
  string section = 10;
  int32 subsection = 11;
  repeated int32 ticket_ids = 4;
  repeated string seat_positions = 5;
  int64 paid_at = 6;  // Unix timestamp ms
  double total_amount = 7;
  // OpenTelemetry W3C Trace Context
  string traceparent = 8;
  string tracestate = 9;
}

// 3. Ticketing → Reservation: Booking cancelled
message BookingCancelledEvent {
  string booking_id = 1;
  int32 buyer_id = 2;
  int32 event_id = 3;
  string section = 9;
  int32 subsection = 10;
  repeated int32 ticket_ids = 4;
  repeated string seat_positions = 5;
  int64 cancelled_at = 6;  // Unix timestamp ms
  // OpenTelemetry W3C Trace Context
  string traceparent = 7;
  string tracestate = 8;
}
